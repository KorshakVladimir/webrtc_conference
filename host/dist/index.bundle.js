!function(e){var n={};function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=4)}([function(e,n){e.exports=function(e,n,t){return n<t?e<n?n:e>t?t:e:e<t?t:e>n?n:e}},function(e,n,t){var o=t(0);e.exports=function(e,n,t){var i=n/2,r=Math.round(e/i*t);return o(r,0,t)}},function(e,n,t){var o=t(1);function i(e,n,t,i,r){for(var a=n.context.sampleRate,c=n.frequencyBinCount,u=o(i,a,c),s=o(r,a,c),d=s-u,f=0;u<s;u++)f+=t[u]/e;return 0===d?0:f/d}e.exports=i.bind(null,255),e.exports.floatData=i.bind(null,1)},function(e,n,t){"use strict";var o=t(2);e.exports=function(e,n,t){t=t||{};var i={fftSize:1024,bufferLen:1024,smoothingTimeConstant:.2,minCaptureFreq:85,maxCaptureFreq:255,noiseCaptureDuration:1e3,minNoiseLevel:.3,maxNoiseLevel:.7,avgNoiseMultiplier:1.2,onVoiceStart:function(){},onVoiceStop:function(){},onUpdate:function(e){}},r={};for(var a in i)r[a]=t.hasOwnProperty(a)?t[a]:i[a];var c=0,u=1,s=0,d=0,f=60,l=5,p=[],m=!0,v=void 0,g=!1,C=null,x=e.createMediaStreamSource(n),w=e.createAnalyser();w.smoothingTimeConstant=r.smoothingTimeConstant,w.fftSize=r.fftSize;var S=e.createScriptProcessor(r.bufferLen,1,1);function y(){x.connect(w),w.connect(S),S.connect(e.destination)}function h(){S.disconnect(),w.disconnect(),x.disconnect()}return y(),S.onaudioprocess=function(){var e=new Uint8Array(w.frequencyBinCount);w.getByteFrequencyData(e);var n=o(w,e,r.minCaptureFreq,r.maxCaptureFreq);if(m)return void p.push(n);n>=c&&s<f?s++:n<c&&s>d&&s--;v!==(g=s>l)&&(g?r.onVoiceStart():r.onVoiceStop(),v=g);r.onUpdate(Math.max(0,n-c)/u)},m&&(C=setTimeout(function(){m=!1;var e=(p=p.filter(function(e){return e}).sort()).length?p.reduce(function(e,n){return Math.min(e,n)},1):r.minNoiseLevel||.1;c=e*r.avgNoiseMultiplier,r.minNoiseLevel&&c<r.minNoiseLevel&&(c=r.minNoiseLevel);r.maxNoiseLevel&&c>r.maxNoiseLevel&&(c=r.maxNoiseLevel);u=1-c},r.noiseCaptureDuration)),{connect:y,disconnect:h,destroy:function(){C&&clearTimeout(C),h(),S.onaudioprocess=null}}}},function(e,n,t){"use strict";var o,i,r,a,c,u,s=t(3),d=document.querySelector("#localVideo"),f=[],l=io.connect("localhost:9090"),p={iceServers:[{urls:"stun:stun.l.google.com:19302"}]};function m(e){window.AudioContext=window.AudioContext||window.webkitAudioContext,u=new AudioContext,o=e,d.srcObject=e,function(e){s(u,e,{fftSize:1024,bufferLen:1024,smoothingTimeConstant:.2,minCaptureFreq:85,maxCaptureFreq:255,noiseCaptureDuration:1e3,minNoiseLevel:.3,maxNoiseLevel:.7,avgNoiseMultiplier:1.2,onVoiceStart:function(){console.log("start")},onVoiceStop:function(){console.log("stop")}})}(e),g(),i.addStream(o)}function v(e){l.emit("message",a,e)}function g(){try{const e=f.push(new RTCPeerConnection(null));(i=f[e-1]).setConfiguration(p),i.onicecandidate=C,i.onaddstream=S,i.onremovestream=y}catch(e){return void console.log(e)}}function C(e){e.candidate&&v({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate})}function x(e){}function w(e){i.setLocalDescription(e),v(e)}function S(e){r=e.stream,d.srcObject=r}function y(e){}function h(e){}l.emit("create or join","foo"),l.on("join",function(e,n){a=e,console.log(n),g()}),l.on("joined",function(e){console.log("joined"),a=e,c||(g(),i.addStream(r)),i.createOffer(w,x)}),l.on("created",function(e){console.log(e),c=!0,navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(m).catch(function(e){alert("getUserMedia() error: "+e)})}),l.on("message",function(e){if("offer"===e.type)i.setRemoteDescription(new RTCSessionDescription(e)),console.log("Sending answer to peer."),i.createAnswer().then(w,h);else if("answer"===e.type)i.setRemoteDescription(new RTCSessionDescription(e));else if("candidate"===e.type){var n=new RTCIceCandidate({sdpMLineIndex:e.label,candidate:e.candidate});i.addIceCandidate(n)}else"bye"===e&&handleRemoteHangup()}),window.onbeforeunload=function(){l.emit("remove_peer",a)}}]);
//# sourceMappingURL=index.bundle.js.map